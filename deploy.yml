---
- name: Playbook to Download and Deploy Artifact in tomcat
  hosts: "{{ deploy_host }}"    
  tasks:
  - name: Create a Directory /opt/Downloads
    become: yes
    file:
      path: /opt/Downloads
      state: directory
      mode: 0755
      owner: tomcat9
      group: tomcat9

  - name: Download Artifact from Artifactory
    become: yes
    get_url:
      url: http://3.144.226.218:8082/artifactory/jackpiro-snapshot-repo-local/com/mkyong/JackPiro/1.2.8-SNAPSHOT/JackPiro-1.2.8-20250107.062017-1.war
      url_password: Admin123
      url_username: admin
      dest: /opt/Downloads/JackPiro.war
      mode: 0755
      group: tomcat9
      owner: tomcat9
      
  - name: Copy File to webapp folder
    become: yes
    copy:
      src: /opt/Downloads/JackPiro.war
      dest: /var/lib/tomcat9/webapps
      remote_src: yes
      mode: 0755
      owner: tomcat9
      group: tomcat9
      
  - name: Delete a Directory /opt/Downloads
    become: yes
    file:
      path: /opt/Downloads
      state: absent
